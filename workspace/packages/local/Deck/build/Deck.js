Ext.define("Deck.util.Global",{singleton:true,editing:location.search.match(/\edit\b/),constructor:function(){this.language="_default";if(location.search){var a=Ext.Object.fromQueryString(location.search[1]);this.language=(a.language||this.language)}this.callParent(arguments)},rightShift:function(e,b){b=(b%e.length);var d=_.first(e,b);var c=_.last(e,(e.length-b));var a=c.concat(d);return a},testShiftArray:function(){var b=[1,2,3,4,5];console.log(Ext.Array.equals(Deck.util.Global.rightShift(b,0),[1,2,3,4,5]));console.log(Ext.Array.equals(Deck.util.Global.rightShift(b,1),[2,3,4,5,1]));console.log(Ext.Array.equals(Deck.util.Global.rightShift(b,2),[3,4,5,1,2]));console.log(Ext.Array.equals(Deck.util.Global.rightShift(b,3),[4,5,1,2,3]));console.log(Ext.Array.equals(Deck.util.Global.rightShift(b,4),[5,1,2,3,4]));console.log(Ext.Array.equals(Deck.util.Global.rightShift(b,5),[1,2,3,4,5]));console.log(Ext.Array.equals(Deck.util.Global.rightShift(b,6),[2,3,4,5,1]))},getNext:function(c,f,e){e=Ext.isDefined(e)?e:true;var d=Ext.Array.indexOf(c,f);var b=null;if(c.length===0){}else{if(d===-1){}else{if(e){if(d<(c.length-1)){b=c[d+1]}else{b=c[0]}}else{if(d>0){b=c[d-1]}else{b=c[c.length-1]}}}}return b},testGetNext:function(){var b=[1,2,3,4,5];console.log(Deck.util.Global.getNext(b,1,true)===2);console.log(Deck.util.Global.getNext(b,2,true)===3);console.log(Deck.util.Global.getNext(b,3,true)===4);console.log(Deck.util.Global.getNext(b,4,true)===5);console.log(Deck.util.Global.getNext(b,5,true)===1);console.log(Deck.util.Global.getNext(b,6,true)===null);console.log(Deck.util.Global.getNext(b,1)===2);console.log(Deck.util.Global.getNext(b,2)===3);console.log(Deck.util.Global.getNext(b,3)===4);console.log(Deck.util.Global.getNext(b,1,false)===5);console.log(Deck.util.Global.getNext(b,2,false)===1);console.log(Deck.util.Global.getNext(b,3,false)===2);console.log(Deck.util.Global.getNext(b,4,false)===3);console.log(Deck.util.Global.getNext(b,5,false)===4);console.log(Deck.util.Global.getNext(b,6,false)===null)}});Ext.define("Deck.util.Backend",{extend:"Ext.Mixin",singleton:true,constructor:function(){this.callParent(arguments);this.persistNodeBuffered=Ext.Function.createBuffered(this.persistNode,1000,this)},persistNode:function(c){var b=this;console.log("persistNode");if(!c){return}var f={id:c.data.id,i18n:Ext.clone(c.data.i18n),leaf:c.isLeaf()};if(!c.isLeaf()&&c.childNodes){f.children=[];Ext.Array.forEach(c.childNodes,function(h){f.children.push(h.data.id)})}var e=Ext.manifest.name;var g=c.data.id;var d=Ext.JSON.encode(f);var a="http://localhost:3000/saveNode?";a+="app="+e+"&";a+="data="+d+"&";a+="id="+g;a=encodeURI(a);b._send(a)},persistContent:function(a,b){},_send:function(a){Ext.Ajax.request({url:a}).then(function(b){Ext.toast({html:"Changes Saved",title:node.data.text,width:200,align:"tr"})},function(b){if(b.status===0){Ext.toast("Did you start the Node server?","Error Saving")}else{Ext.toast(b.statusText,"Error Saving "+node.data.text)}})}});Ext.define("Deck.model.Node",{extend:"Ext.data.TreeModel",extend:"Ext.data.TreeModel",requires:["Deck.util.Global","Deck.util.Backend"],statics:{cache:{},getCachedContent:function(a){return Deck.model.Node.cache[a]}},fields:["i18n",{name:"text",convert:function(d,b){var c=b.data.i18n;if(!c){return""}var a;var e=b.data.language;if(c[e]){a=c[e].title}a=(a||b.data.i18n._default.title);if(b.data.id==="2015-06-08_22-34_58-147_Z"){console.log(a)}return a},depends:["language","i18n"]},{name:"language",defaultValue:"_default"},{name:"leaf",convert:function(b,a){return a.data.leaf||!a.data.children}}],updateText:function(c){var a=this;var d=a.data.language;if(a.data.i18n[d]&&(a.data.i18n[d].title===c)){return}var b=Ext.clone(a.data.i18n);b[d]=b[d]||{persisted:false,title:""};b[d].title=c;a.set("i18n",b)},getPersistableNode:function(){var a={id:node.data.id,i18n:Ext.clone(node.data.i18n),leaf:node.isLeaf()};if(!node.isLeaf()&&node.childNodes){a.children=[];Ext.Array.forEach(node.childNodes,function(b){a.children.push(b.data.id)})}},getContent:function(){var c=this;var b=Ext.create("Ext.Deferred");if(!c.isRoot()&&c.isLeaf()){a()}else{b.resolve(c.data.text)}return b.promise;function a(){var g=Deck.util.Global.language;var e=c.data.i18n;var d=c.data.id;var f=Deck.model.Node.getCachedContent(d);if(f){b.resolve(f)}else{if(d){Ext.Ajax.request({url:("resources/pages/content/_default/"+d+".md")}).then(function(h){f=h.responseText;f=marked(f);c.cacheContent(f);b.resolve(f)},function(h){b.reject(h)})}else{b.resolve("")}}}},persistNode:function(){Deck.util.Backend.persistNode(this)},persistContent:function(a){lanuage=a||"_default"},cacheContent:function(a){if(this.data.id){Deck.model.Node.cache[this.data.id]=a}}});Ext.define("Deck.store.Topics",{extend:"Ext.data.TreeStore",alias:"store.deck-topics",model:"Deck.model.Node",statics:{loadNodes:function(c){var f=this;c=(c||[]);var d=new Ext.Deferred();var h={};var b=[];var e=0;a(h,"_root",c);return d;function a(l,m,i){var k=this;e++;var j="resources/pages/nodes/"+m+".json";Ext.Ajax.request({url:j,node:l,success:function(n,o){var q=Ext.JSON.decode(n.responseText);var r=o.node;Ext.apply(r,q);r.hidden=Ext.Array.contains(i,r.fileId);if(r.children){var t=Ext.Array.clone(r.children);r.children=[];for(var p=0;p<t.length;p++){var s=t[p];if(Ext.Array.contains(i,s)){console.log("Skipping "+s)}else{var u={};r.children.push(u);a(u,s,i)}}}g()},failure:function(n,o){g();if(n.status===404){b.push(m)}console.log("Dangling reference. Failed to read "+m+" under "+l.fileId);console.log(l);console.log(n)}})}function g(){var i=this;e--;if(e===0){d.resolve(h,b)}}}},getNodeArray:function(b){var c=this;b=!!b;if(b||!c._nodeArray){c._nodeArray=[];var a=c.getRoot();a.cascadeBy(function(d){if(!d.isRoot()){c._nodeArray.push(d)}})}return c._nodeArray},findNextOrPrevious:function(e,d){d=!!d;var c=Ext.Array.indexOf(this.getNodeArray(),e);if(c===-1){return null}else{var b=this.getNodeArray();if(d){result=((c===0)?b[b.length-1]:b[c-1])}else{result=((c===(b.length-1))?b[0]:b[c+1])}}return result},findNode:function(e,d,a){a=Ext.isDefined(a)?a:true;var c=new RegExp(d.trim(),"i");var f=this.getNodeArray();if(!a){f=f.slice().reverse()}for(var b=0;b<f.length;b++){if(f[b].data.id.match(c)||f[b].data.text.match(c)){break}}if(b>=f.length){result=e}else{result=f[b]}return result},getNext:function(e,d){var c=this.getNodeArray();var b=Deck.util.Global.getNext(c,e,d);return b}});Ext.define("Deck.view.main.MainController",{extend:"Ext.app.ViewController",alias:"controller.maincontroller"});Ext.define("Deck.view.main.Main",{xtype:"deck-main",extend:"Ext.Container",requires:["Deck.view.main.MainController"],controller:"maincontroller",html:"modern"});